<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø·Ù„Ø¨Ø§Øª Ù…Ø®ØªÙ„Ù</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --danger: #f72585;
            --success: #4ade80;
            --warning: #f59e0b;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --radius: 12px;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .admin-header {
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            padding: 20px 0;
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-section img {
            height: 60px;
            filter: drop-shadow(0 2px 10px rgba(76, 201, 240, 0.4));
        }

        .logo-section h1 {
            color: var(--accent);
            font-size: 1.8rem;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .btn-secondary {
            background: var(--dark-light);
            color: var(--light);
            border: 1px solid var(--gray);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #16a34a);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #be185d);
            color: white;
        }

        /* Stats Cards */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 15px 35px rgba(76, 201, 240, 0.2);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        .stat-card h3 {
            font-size: 0.95rem;
            color: var(--gray-light);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .change-up {
            color: var(--success);
        }

        .change-down {
            color: var(--danger);
        }

        /* Country Stats Section */
        .country-stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .country-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .country-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .country-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .country-flag {
            font-size: 2.5rem;
        }

        .country-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--accent);
        }

        .country-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .saudi-badge {
            background: rgba(0, 104, 56, 0.2);
            color: #00ff88;
            border: 1px solid rgba(0, 104, 56, 0.3);
        }

        .egypt-badge {
            background: rgba(206, 17, 38, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(206, 17, 38, 0.3);
        }

        .country-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .country-stat-row:last-child {
            border-bottom: none;
            font-weight: bold;
            color: var(--accent);
            padding-top: 20px;
            margin-top: 10px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        .country-stat-label {
            color: var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .country-stat-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Filters Section */
        .filters-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 220px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray-light);
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ */
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 12px 15px;
            background: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: var(--light) !important;
            font-size: 1rem;
            transition: var(--transition);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 15px center !important;
            background-size: 12px !important;
            padding-right: 15px !important;
            padding-left: 40px !important;
        }

        .filter-group select option {
            background: #1e293b !important;
            color: var(--light) !important;
            padding: 12px !important;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.1);
        }

        /* Orders Table */
        .orders-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 40px;
        }

        .table-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            background: rgba(15, 23, 42, 0.7);
        }

        .table-header h2 {
            color: var(--accent);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .refresh-info {
            color: var(--gray-light);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-info i {
            color: var(--success);
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .table-content {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }

        th {
            padding: 18px;
            text-align: right;
            background: rgba(30, 41, 59, 0.9);
            color: var(--accent);
            font-weight: 600;
            font-size: 0.95rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
        }

        td {
            padding: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--gray-light);
            font-size: 0.95rem;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Status Badges */
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .status-new {
            background: rgba(67, 97, 238, 0.2);
            color: #4361ee;
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .status-review {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-processing {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-shipping {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .status-delivered {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-ready {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Discount Badge */
        .discount-badge {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            border: 1px solid rgba(74, 222, 128, 0.3);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-right: 5px;
        }

        /* Payment Status */
        .payment-status-select {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 10px center !important;
            background-size: 10px !important;
            padding-right: 10px !important;
            padding-left: 25px !important;
        }

        .payment-status-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .payment-paid {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border-color: rgba(34, 197, 94, 0.3);
        }

        .payment-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border-color: rgba(245, 158, 11, 0.3);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-view {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .btn-view:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .btn-edit {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .btn-edit:hover {
            background: rgba(245, 158, 11, 0.3);
            transform: translateY(-2px);
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .btn-delete:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--dark-light);
            border-radius: var(--radius);
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.9);
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .modal-header h3 {
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.3rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray-light);
            font-size: 28px;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .modal-body {
            padding: 30px;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            color: var(--accent);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-item strong {
            display: block;
            color: var(--gray-light);
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .info-item span {
            color: white;
            font-weight: 500;
            font-size: 1.05rem;
        }

        .address-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            line-height: 1.6;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .products-table th {
            background: rgba(67, 97, 238, 0.2);
            color: var(--accent);
            padding: 12px 15px;
            font-size: 0.9rem;
        }

        .products-table td {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        .products-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .order-number {
            font-family: 'Courier New', monospace;
            background: rgba(76, 201, 240, 0.1);
            padding: 5px 12px;
            border-radius: 6px;
            color: var(--accent);
            font-weight: bold;
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 50px;
            width: 100%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-header i {
            font-size: 70px;
            color: var(--accent);
            margin-bottom: 25px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .login-header h1 {
            color: white;
            margin-bottom: 15px;
            font-size: 2rem;
        }

        .login-header p {
            color: var(--gray-light);
            font-size: 1.1rem;
        }

        .login-form .form-group {
            margin-bottom: 25px;
        }

        .login-form label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray-light);
            font-size: 1rem;
        }

        .login-form input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: white;
            font-size: 1rem;
            transition: var(--transition);
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
        }

        .login-form button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .login-form button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        /* No Data */
        .no-data {
            text-align: center;
            padding: 60px;
            color: var(--gray-light);
        }

        .no-data i {
            font-size: 50px;
            margin-bottom: 20px;
            color: var(--gray);
        }

        .no-data p {
            font-size: 1.1rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--accent);
        }

        .loading i {
            font-size: 40px;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        .loading p {
            font-size: 1.1rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #16a34a);
            color: white;
            padding: 20px 25px;
            border-radius: var(--radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.show {
            display: flex;
        }

        .notification i {
            font-size: 24px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0 5px;
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #be185d);
        }

        /* Financial Summary */
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .financial-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 15px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.03);
        }

        .financial-item .label {
            font-size: 0.85rem;
            color: var(--gray-light);
            margin-bottom: 8px;
        }

        .financial-item .value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--accent);
        }

        .financial-item.discount .value {
            color: var(--success);
        }

        .financial-item.original .value {
            color: var(--gray-light);
            text-decoration: line-through;
        }

        /* Discount Details */
        .discount-details {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.2);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 20px;
        }

        .discount-details h4 {
            color: var(--success);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .discount-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .discount-row:last-child {
            border-bottom: none;
            font-weight: bold;
            color: var(--success);
        }

        /* Payment Filter Styling */
        .payment-filter-select {
            padding: 12px 15px;
            background: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: var(--light) !important;
            font-size: 1rem;
            transition: var(--transition);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 15px center !important;
            background-size: 12px !important;
            padding-right: 15px !important;
            padding-left: 40px !important;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .country-stats-section {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .admin-info {
                flex-direction: column;
                width: 100%;
            }
            
            .filters-section {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .table-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            .login-box {
                padding: 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div class="notification-content">
            <strong id="notificationTitle"></strong>
            <p id="notificationMessage"></p>
        </div>
        <button class="notification-close" onclick="hideNotification()">Ã—</button>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <i class="fas fa-lock"></i>
                <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
                <p>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="adminEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="adminEmail" placeholder="admin@  .com" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="adminPassword" placeholder="" required>
                </div>
                <button type="submit">
                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display: none;">
        <!-- Header -->
        <header class="admin-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo-section">
                        <img src="logo-removebg-preview.png" alt="Ù…Ø®ØªÙ„Ù" onerror="this.src='https://via.placeholder.com/60?text=Logo'">
                        <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø·Ù„Ø¨Ø§Øª Ù…Ø®ØªÙ„Ù</h1>
                    </div>
                    <div class="admin-info">
                        <div class="user-info">
                            <i class="fas fa-user-circle"></i>
                            <span id="userEmail">admin@different.com</span>
                        </div>
                        <button class="btn btn-secondary" onclick="refreshOrders()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button class="btn btn-success" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                        </button>
                        <button class="btn btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container">
            <!-- Stats Cards -->
            <section class="stats-section">
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(67, 97, 238, 0.2); color: #4361ee;">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-change change-up" id="ordersChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(34, 197, 94, 0.2); color: #22c55e;">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <div class="stat-value" id="newOrders">0</div>
                    <div class="stat-change change-up" id="newOrdersChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h3>
                    <div class="stat-value" id="processingOrders">0</div>
                    <div class="stat-change change-up" id="processingChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(168, 85, 247, 0.2); color: #a855f7;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø©</h3>
                    <div class="stat-value" id="readyOrders">0</div>
                    <div class="stat-change change-up" id="readyChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù† -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6;">
                        <i class="fas fa-truck"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</h3>
                    <div class="stat-value" id="shippingOrders">0</div>
                    <div class="stat-change change-up" id="shippingChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ù„Ù…Ø© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2); color: #10b981;">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù…Ø³Ù„Ù…Ø©</h3>
                    <div class="stat-value" id="deliveredOrders">0</div>
                    <div class="stat-change change-up" id="deliveredChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(0, 104, 56, 0.2); color: #00ff88;">
                        <i class="fas fa-flag"></i>
                    </div>
                    <h3>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h3>
                    <div class="stat-value" id="saudiRevenue">0 Ø±.Ø³</div>
                    <div class="stat-change change-up" id="saudiRevenueChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…ØµØ± -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(206, 17, 38, 0.2); color: #ff6b6b;">
                        <i class="fas fa-flag"></i>
                    </div>
                    <h3>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…ØµØ±</h3>
                    <div class="stat-value" id="egyptRevenue">0 Ø¬.Ù…</div>
                    <div class="stat-change change-up" id="egyptRevenueChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ… -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(74, 222, 128, 0.2); color: #4ade80;">
                        <i class="fas fa-tag"></i>
                    </div>
                    <h3>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ…</h3>
                    <div class="stat-value" id="discountOrders">0</div>
                    <div class="stat-change change-up" id="discountChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆÙÙŠØ± Ù…Ù† Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª -->
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(245, 158, 11, 0.2); color: #f59e0b;">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆÙÙŠØ±</h3>
                    <div class="stat-value" id="totalSavings">0</div>
                    <div class="stat-change change-up" id="savingsChange">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0 Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
            </section>

            <!-- Country Statistics -->
            <section class="country-stats-section">
                <!-- Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© -->
                <div class="country-stat-card">
                    <div class="country-header">
                        <div class="country-title">
                            <div class="country-flag">ğŸ‡¸ğŸ‡¦</div>
                            <div>
                                <div class="country-name">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
                                <div style="font-size: 0.9rem; color: var(--gray-light);">SAR - Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</div>
                            </div>
                        </div>
                        <div class="country-badge saudi-badge">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="saudiOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ØµØ§ÙÙŠØ©</span>
                        </div>
                        <div class="country-stat-value" id="saudiNetRevenue">0 Ø±.Ø³</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-box"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="saudiProductRevenue">0 Ø±.Ø³</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-truck"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø­Ù†</span>
                        </div>
                        <div class="country-stat-value" id="saudiShippingRevenue">0 Ø±.Ø³</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-tag"></i>
                            <span>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ…</span>
                        </div>
                        <div class="country-stat-value" id="saudiDiscountOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-users"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                        </div>
                        <div class="country-stat-value" id="saudiCustomers">0</div>
                    </div>
                </div>
                
                <!-- Ù…ØµØ± -->
                <div class="country-stat-card">
                    <div class="country-header">
                        <div class="country-title">
                            <div class="country-flag">ğŸ‡ªğŸ‡¬</div>
                            <div>
                                <div class="country-name">Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ù…ØµØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                                <div style="font-size: 0.9rem; color: var(--gray-light);">EGP - Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</div>
                            </div>
                        </div>
                        <div class="country-badge egypt-badge">Ù…ØµØ±</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="egyptOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ØµØ§ÙÙŠØ©</span>
                        </div>
                        <div class="country-stat-value" id="egyptNetRevenue">0 Ø¬.Ù…</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-box"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                        </div>
                        <div class="country-stat-value" id="egyptProductRevenue">0 Ø¬.Ù…</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-truck"></i>
                            <span>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø­Ù†</span>
                        </div>
                        <div class="country-stat-value" id="egyptShippingRevenue">0 Ø¬.Ù…</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-tag"></i>
                            <span>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ…</span>
                        </div>
                        <div class="country-stat-value" id="egyptDiscountOrders">0</div>
                    </div>
                    
                    <div class="country-stat-row">
                        <div class="country-stat-label">
                            <i class="fas fa-users"></i>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                        </div>
                        <div class="country-stat-value" id="egyptCustomers">0</div>
                    </div>
                </div>
            </section>

            <!-- Filters -->
            <section class="filters-section">
                <div class="filter-group">
                    <label for="filterCountry"><i class="fas fa-globe"></i> Ø§Ù„Ø¨Ù„Ø¯</label>
                    <select id="filterCountry">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù„Ø¯Ø§Ù†</option>
                        <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                        <option value="Ù…ØµØ±">Ù…ØµØ±</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterStatus"><i class="fas fa-tag"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</label>
                    <select id="filterStatus">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                        <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                        <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                        <option value="Ø¬Ø§Ù‡Ø²">Ø¬Ø§Ù‡Ø²</option>
                        <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†">Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</option>
                        <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                        <option value="Ù…Ù„ØºÙŠ">Ù…Ù„ØºÙŠ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterPayment"><i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select id="filterPayment">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="bank-transfer">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                        <option value="stc-pay">STC Pay</option>
                        <option value="vodafone-cash">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
                        <option value="instapay">Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ</option>
                        <option value="cod">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterPaymentStatus"><i class="fas fa-money-bill-wave"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    <select id="filterPaymentStatus" class="payment-filter-select">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="paid">ØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                        <option value="pending">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filterDiscount"><i class="fas fa-tag"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ…</label>
                    <select id="filterDiscount">
                        <option value="">Ø§Ù„ÙƒÙ„</option>
                        <option value="with-discount">Ù…Ø¹ Ø®ØµÙ…</option>
                        <option value="without-discount">Ø¨Ø¯ÙˆÙ† Ø®ØµÙ…</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="searchOrders"><i class="fas fa-search"></i> Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…</label>
                    <input type="text" id="searchOrders" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ØŒ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ...">
                </div>
            </section>

            <!-- Orders Table -->
            <section class="orders-container">
                <div class="table-header">
                    <h2><i class="fas fa-list-ol"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                    <div class="refresh-info">
                        <i class="fas fa-sync-alt"></i>
                        <span id="lastUpdate">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: --:--</span>
                    </div>
                </div>
                
                <div class="table-content">
                    <div id="loading" class="loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
                    </div>
                    
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ø¨Ù„Ø¯</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                                <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>Ø§Ù„Ø®ØµÙ…</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="ordersBody">
                            <tr>
                                <td colspan="13" class="no-data">
                                    <i class="fas fa-shopping-cart"></i>
                                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Order Details Modal -->
    <div class="modal-overlay" id="orderModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Status Edit Modal -->
    <div class="modal-overlay" id="statusModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" onclick="closeStatusModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="statusModalContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const firebaseConfig = {
            apiKey: "AIzaSyBEKzQ_S_WRMLWLHk8fLTrIjrN4bvbYb0",
            authDomain: "different-store-admin.firebaseapp.com",
            projectId: "different-store-admin",
            storageBucket: "different-store-admin.firebasestorage.app",
            messagingSenderId: "75347854869d",
            appId: "1:75347854869d:web:044088f5cf63bf3c74c10b"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let db;
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        db = firebase.firestore();

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let allOrders = [];
        let currentUser = null;
        let currentFilteredOrders = [];
        let autoRefreshInterval = null;
        let deletedOrders = new Set();

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø´Ø­Ù† Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
        const shippingPrices = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {
                'Ø§Ù„Ø±ÙŠØ§Ø¶': 25,
                'Ø¬Ø¯Ø©': 25,
                'Ù…ÙƒØ©': 25,
                'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©': 25,
                'Ø§Ù„Ø¯Ù…Ø§Ù…': 25,
                'Ø§Ù„Ø®Ø¨Ø±': 25,
                'Ø§Ù„Ø·Ø§Ø¦Ù': 25,
                'ØªØ¨ÙˆÙƒ': 25,
                'Ø£Ø¨Ù‡Ø§': 25,
                'Ø­Ø§Ø¦Ù„': 25,
                'Ø§Ù„Ø¨Ø§Ø­Ø©': 25,
                'Ø§Ù„Ø¬ÙˆÙ': 25,
                'Ù†Ø¬Ø±Ø§Ù†': 25,
                'Ø¹Ø±Ø¹Ø±': 25,
                'Ø³ÙƒØ§ÙƒØ§': 25,
                'Ø¨Ø±ÙŠØ¯Ø©': 25,
                'Ø¹Ù†ÙŠØ²Ø©': 25,
                'Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†': 10,
                'Ø§Ù„Ø®ÙØ¬ÙŠ': 25,
                'Ø§Ù„Ù‚Ø·ÙŠÙ': 25,
                'Ø§Ù„Ù‡ÙÙˆÙ': 25,
                'Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©': 25,
                'default': 25
            },
            'Ù…ØµØ±': {
                'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©': 55,
                'Ø§Ù„Ø¬ÙŠØ²Ø©': 55,
                'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©': 80,
                'Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©': 70,
                'Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±': 80,
                'Ø§Ù„Ø¨Ø­ÙŠØ±Ø©': 80,
                'Ø§Ù„ÙÙŠÙˆÙ…': 55,
                'Ø§Ù„ØºØ±Ø¨ÙŠØ©': 70,
                'Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©': 70,
                'Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©': 70,
                'Ø§Ù„Ù…Ù†ÙŠØ§': 50,
                'Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©': 55,
                'Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯': 95,
                'Ø§Ù„Ø³ÙˆÙŠØ³': 70,
                'Ø£Ø³ÙˆØ§Ù†': 95,
                'Ø£Ø³ÙŠÙˆØ·': 55,
                'Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ': 55,
                'Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯': 80,
                'Ø¯Ù…ÙŠØ§Ø·': 80,
                'Ø³ÙˆÙ‡Ø§Ø¬': 55,
                'Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡': 95,
                'ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®': 80,
                'Ù…Ø·Ø±ÙˆØ­': 95,
                'Ø§Ù„Ø£Ù‚ØµØ±': 80,
                'Ù‚Ù†Ø§': 70,
                'Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡': 85,
                'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©': 70,
                'default': 70
            }
        };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (email === 'admin@different.com' && password === 'admin123') {
                currentUser = { email, name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…' };
                localStorage.setItem('checkout_admin', JSON.stringify(currentUser));
                showDashboard();
                loadOrders();
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
            } else {
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        });

        // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
        function checkAuth() {
            const savedUser = localStorage.getItem('checkout_admin');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
                loadOrders();
                startAutoRefresh();
                return true;
            }
            return false;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('checkout_admin');
                currentUser = null;
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                }
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            if (currentUser) {
                document.getElementById('userEmail').textContent = currentUser.email;
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function startAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            autoRefreshInterval = setInterval(() => {
                refreshOrders();
            }, 30000);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        async function loadOrders() {
            try {
                document.getElementById('loading').style.display = 'block';
                
                let orders = [];
                
                // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                const deleted = JSON.parse(localStorage.getItem('deleted_orders')) || [];
                deletedOrders = new Set(deleted);
                
                // 2. ØªØ­Ù…ÙŠÙ„ Ù…Ù† Firebase Ù…Ø¹ ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹
                try {
                    const snapshot = await db.collection('orders')
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const orderId = data.orderNumber || data.orderId || doc.id;
                        
                        if (!deletedOrders.has(orderId.toString())) {
                            let shippingCost = calculateShippingCost(data);
                            const discountInfo = extractDiscountInfo(data);
                            
                            orders.push({
                                id: doc.id,
                                firebaseId: doc.id,
                                orderId: orderId,
                                ...data,
                                shippingCost: shippingCost,
                                discountInfo: discountInfo,
                                source: 'firebase',
                                isDeleted: false
                            });
                        }
                    });
                } catch (firebaseError) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', firebaseError.message);
                }
                
                // 3. ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø©
                try {
                    const savedOrders = JSON.parse(localStorage.getItem('orders')) || [];
                    const savedNewOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                    
                    savedOrders.forEach(order => {
                        if (order.orderNumber && !deletedOrders.has(order.orderNumber.toString())) {
                            let shippingCost = calculateShippingCost(order);
                            const discountInfo = extractDiscountInfo(order);
                            
                            orders.push({
                                id: order.orderNumber.toString(),
                                orderId: order.orderNumber,
                                ...order,
                                shippingCost: shippingCost,
                                discountInfo: discountInfo,
                                source: 'local',
                                isDeleted: false
                            });
                        }
                    });
                    
                    savedNewOrders.forEach(order => {
                        if (order.orderId && !deletedOrders.has(order.orderId.toString())) {
                            let shippingCost = calculateShippingCost(order);
                            const discountInfo = extractDiscountInfo(order);
                            
                            orders.push({
                                id: order.orderId.toString(),
                                orderId: order.orderId,
                                ...order,
                                shippingCost: shippingCost,
                                discountInfo: discountInfo,
                                source: 'new',
                                isDeleted: false
                            });
                        }
                    });
                } catch (localError) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage:', localError);
                }
                
                // 4. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
                allOrders = removeDuplicates(orders);
                currentFilteredOrders = [...allOrders];
                
                // 5. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateAllStats(allOrders);
                
                // 6. Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                displayOrders(allOrders);
                
                // 7. ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                updateLastUpdateTime();
                
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
                document.getElementById('loading').style.display = 'none';
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„', error.message, 'error');
            }
        }

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø·Ù„Ø¨
        function extractDiscountInfo(order) {
            const discount = order.discount || {};
            const totals = order.totals || {};
            
            return {
                applied: discount.applied || false,
                code: discount.code || '',
                amount: discount.amount || 0,
                originalTotal: discount.originalTotal || totals.total || 0,
                finalTotal: totals.total || order.total || 0,
                shippingCost: order.shippingCost || totals.shipping || 0,
                freeShipping: discount.applied || false,
                description: discount.applied ? 
                    (order.customer?.address?.country === 'Ù…ØµØ±' ? 
                     'Ø®ØµÙ… 20% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ (259 Ø¬.Ù…)' : 
                     'Ø®ØµÙ… 20% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ') : 
                    'Ø¨Ø¯ÙˆÙ† Ø®ØµÙ…'
            };
        }

        // Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù† Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
        function calculateShippingCost(order) {
            try {
                const customer = order.customer || {};
                const address = customer.address || {};
                const country = address.country || customer.country;
                const governorate = address.governorate || customer.governorate || '';
                
                if (!country || !governorate) {
                    return order.totals?.shipping || 0;
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®ØµÙ… (ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ)
                if (order.discount?.applied) {
                    return 0;
                }
                
                const countryShipping = shippingPrices[country];
                if (!countryShipping) {
                    return country === 'Ù…ØµØ±' ? 60 : 30;
                }
                
                let shippingCost = countryShipping.default || (country === 'Ù…ØµØ±' ? 60 : 30);
                
                const foundGovernorate = Object.keys(countryShipping).find(gov => 
                    gov.includes(governorate) || governorate.includes(gov)
                );
                
                if (foundGovernorate && countryShipping[foundGovernorate]) {
                    shippingCost = countryShipping[foundGovernorate];
                }
                
                return shippingCost;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†:', error);
                return order.totals?.shipping || 0;
            }
        }

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
        function removeDuplicates(orders) {
            const orderMap = new Map();
            orders.forEach(order => {
                const key = order.orderId || order.id;
                if (key && !orderMap.has(key.toString())) {
                    orderMap.set(key.toString(), order);
                }
            });
            return Array.from(orderMap.values())
                .sort((a, b) => {
                    const dateA = new Date(a.createdAt || 0);
                    const dateB = new Date(b.createdAt || 0);
                    return dateB - dateA;
                });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateAllStats(orders) {
            const today = new Date().toDateString();
            
            // ØªØµÙ†ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¨Ù„Ø¯
            const saudiOrders = orders.filter(order => 
                order.customer?.address?.country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' || 
                order.customer?.country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'
            );
            
            const egyptOrders = orders.filter(order => 
                order.customer?.address?.country === 'Ù…ØµØ±' || 
                order.customer?.country === 'Ù…ØµØ±'
            );
            
            // Ø§Ù„ÙŠÙˆÙ…
            const todayOrders = orders.filter(order => {
                const orderDate = new Date(order.createdAt).toDateString();
                return orderDate === today;
            });
            
            // Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹ Ø®ØµÙ…
            const discountOrders = orders.filter(order => 
                order.discount?.applied || order.discountInfo?.applied
            );
            
            const todayDiscountOrders = discountOrders.filter(order => {
                const orderDate = new Date(order.createdAt).toDateString();
                return orderDate === today;
            });
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
            let totalRevenue = 0;
            let saudiNetRevenue = 0;
            let egyptNetRevenue = 0;
            let saudiProductRevenue = 0;
            let egyptProductRevenue = 0;
            let saudiShippingRevenue = 0;
            let egyptShippingRevenue = 0;
            let totalSavings = 0;
            let todaySavings = 0;
            
            orders.forEach(order => {
                const discount = order.discount || order.discountInfo || {};
                const totals = order.totals || {};
                const items = order.items || [];
                const country = order.customer?.address?.country || order.customer?.country;
                
                // Ø­Ø³Ø§Ø¨ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                let productRevenue = 0;
                items.forEach(item => {
                    productRevenue += (item.price || 0) * (item.quantity || 1);
                });
                
                // Ø­Ø³Ø§Ø¨ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø­Ù†
                const shippingRevenue = order.shippingCost || totals.shipping || 0;
                
                // Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ØµØ§ÙÙŠØ© (Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª + Ø§Ù„Ø´Ø­Ù†)
                const netRevenue = productRevenue + shippingRevenue;
                
                totalRevenue += netRevenue;
                
                if (country === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {
                    saudiNetRevenue += netRevenue;
                    saudiProductRevenue += productRevenue;
                    saudiShippingRevenue += shippingRevenue;
                } else if (country === 'Ù…ØµØ±') {
                    egyptNetRevenue += netRevenue;
                    egyptProductRevenue += productRevenue;
                    egyptShippingRevenue += shippingRevenue;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙÙŠØ± Ù…Ù† Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
                if (discount.applied) {
                    const originalTotal = discount.originalTotal || netRevenue;
                    const finalTotal = totals.total || order.total || 0;
                    totalSavings += (originalTotal - finalTotal);
                    
                    const orderDate = new Date(order.createdAt).toDateString();
                    if (orderDate === today) {
                        todaySavings += (originalTotal - finalTotal);
                    }
                }
            });
            
            // Ø§Ù„Ø­Ø§Ù„Ø§Øª
            const processingOrders = orders.filter(order => order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©');
            const readyOrders = orders.filter(order => order.status === 'Ø¬Ø§Ù‡Ø²');
            const shippingOrders = orders.filter(order => order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†');
            const deliveredOrders = orders.filter(order => order.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…');
            
            // Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„ÙØ±ÙŠØ¯ÙŠÙ†
            const allCustomers = [...new Set(orders.map(order => order.customer?.phone))].filter(phone => phone).length;
            const saudiCustomers = [...new Set(saudiOrders.map(order => order.customer?.phone))].filter(phone => phone).length;
            const egyptCustomers = [...new Set(egyptOrders.map(order => order.customer?.phone))].filter(phone => phone).length;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('newOrders').textContent = orders.filter(o => o.status === 'Ø¬Ø¯ÙŠØ¯').length;
            document.getElementById('processingOrders').textContent = processingOrders.length;
            document.getElementById('readyOrders').textContent = readyOrders.length;
            document.getElementById('shippingOrders').textContent = shippingOrders.length;
            document.getElementById('deliveredOrders').textContent = deliveredOrders.length;
            
            document.getElementById('discountOrders').textContent = discountOrders.length;
            document.getElementById('totalSavings').textContent = formatCurrency(totalSavings);
            
            // Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ØµØ§ÙÙŠØ© (Ù…Ø·Ø±ÙˆØ­ Ù…Ù†Ù‡Ø§ Ø§Ù„Ø´Ø­Ù†)
            document.getElementById('saudiRevenue').textContent = formatCurrency(saudiNetRevenue) + ' Ø±.Ø³';
            document.getElementById('egyptRevenue').textContent = formatCurrency(egyptNetRevenue) + ' Ø¬.Ù…';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØºÙŠØ±Ø§Øª
            document.getElementById('ordersChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${todayOrders.length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('processingChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${processingOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('readyChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${readyOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('shippingChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${shippingOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('deliveredChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${deliveredOrders.filter(o => new Date(o.createdAt).toDateString() === today).length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('discountChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${todayDiscountOrders.length} Ø§Ù„ÙŠÙˆÙ…</span>`;
            document.getElementById('savingsChange').innerHTML = `<i class="fas fa-arrow-up"></i><span>+${formatCurrency(todaySavings)} Ø§Ù„ÙŠÙˆÙ…</span>`;
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
            const saudiDiscountOrders = saudiOrders.filter(o => o.discount?.applied || o.discountInfo?.applied);
            document.getElementById('saudiOrders').textContent = saudiOrders.length;
            document.getElementById('saudiNetRevenue').textContent = formatCurrency(saudiNetRevenue) + ' Ø±.Ø³';
            document.getElementById('saudiProductRevenue').textContent = formatCurrency(saudiProductRevenue) + ' Ø±.Ø³';
            document.getElementById('saudiShippingRevenue').textContent = formatCurrency(saudiShippingRevenue) + ' Ø±.Ø³';
            document.getElementById('saudiDiscountOrders').textContent = saudiDiscountOrders.length;
            document.getElementById('saudiCustomers').textContent = saudiCustomers;
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØµØ±
            const egyptDiscountOrders = egyptOrders.filter(o => o.discount?.applied || o.discountInfo?.applied);
            document.getElementById('egyptOrders').textContent = egyptOrders.length;
            document.getElementById('egyptNetRevenue').textContent = formatCurrency(egyptNetRevenue) + ' Ø¬.Ù…';
            document.getElementById('egyptProductRevenue').textContent = formatCurrency(egyptProductRevenue) + ' Ø¬.Ù…';
            document.getElementById('egyptShippingRevenue').textContent = formatCurrency(egyptShippingRevenue) + ' Ø¬.Ù…';
            document.getElementById('egyptDiscountOrders').textContent = egyptDiscountOrders.length;
            document.getElementById('egyptCustomers').textContent = egyptCustomers;
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø©
        function formatCurrency(amount) {
            if (typeof amount !== 'number') amount = 0;
            return amount.toLocaleString('ar-SA');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function displayOrders(orders) {
            const tbody = document.getElementById('ordersBody');
            currentFilteredOrders = orders;
            
            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="13" class="no-data">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            orders.forEach((order, index) => {
                const customer = order.customer || {};
                const address = customer.address || {};
                const totals = order.totals || {};
                const discount = order.discount || order.discountInfo || {};
                
                const orderNumber = order.orderId || order.id || '---';
                const orderDate = formatDate(order.createdAt);
                const customerName = customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±';
                const country = address.country || customer.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const phone = customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const city = address.city || customer.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const governorate = address.governorate || customer.governorate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const paymentMethod = getPaymentMethodArabic(order.payment?.method);
                const currency = totals.currency || (country === 'Ù…ØµØ±' ? 'Ø¬.Ù…' : 'Ø±.Ø³');
                const total = totals.total || order.total || 0;
                const status = order.status || 'Ø¬Ø¯ÙŠØ¯';
                const paymentStatus = order.paymentStatus || 'pending';
                
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®ØµÙ…
                const hasDiscount = discount.applied || false;
                const discountAmount = discount.amount || 0;
                const discountCode = discount.code || '';
                const discountText = hasDiscount ? 
                    `<span class="discount-badge" title="ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…: ${discountCode}">
                        <i class="fas fa-tag"></i> ${formatCurrency(discountAmount)} ${currency}
                    </span>` : 
                    '--';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong class="order-number">#${orderNumber}</strong></td>
                        <td>${orderDate}</td>
                        <td><strong>${customerName}</strong></td>
                        <td>
                            <span class="country-badge ${country === 'Ù…ØµØ±' ? 'egypt-badge' : 'saudi-badge'}">
                                ${country}
                            </span>
                        </td>
                        <td>${phone}</td>
                        <td>${governorate}</td>
                        <td><span class="payment-badge">${paymentMethod}</span></td>
                        <td>
                            <select class="payment-status-select ${paymentStatus === 'paid' ? 'payment-paid' : 'payment-pending'}" 
                                    onchange="updatePaymentStatus('${order.id || order.orderId}', this.value)">
                                <option value="pending" ${paymentStatus === 'pending' ? 'selected' : ''}>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                                <option value="paid" ${paymentStatus === 'paid' ? 'selected' : ''}>ØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                            </select>
                        </td>
                        <td><strong style="color: var(--accent);">${total} ${currency}</strong></td>
                        <td>${discountText}</td>
                        <td>
                            <span class="status-badge status-${getStatusClass(status)}">
                                ${status}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-view" onclick="viewOrderDetails('${order.id || order.orderId}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-edit" onclick="editOrderStatusModal('${order.id || order.orderId}')" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteOrder('${order.id || order.orderId}', '${orderNumber}')" title="Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙ„Ø§ØªØ±
            setupFilters();
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª
        function formatDate(dateString) {
            if (!dateString) return '---';
            try {
                const date = new Date(dateString);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day} ${hours}:${minutes}`;
            } catch (e) {
                return '---';
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        function getPaymentMethodArabic(method) {
            const methods = {
                'bank-transfer': 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ',
                'stc-pay': 'STC Pay',
                'vodafone-cash': 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
                'instapay': 'Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ',
                'cod': 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…'
            };
            return methods[method] || method || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙ„Ø§Ø³ Ø§Ù„Ø­Ø§Ù„Ø©
        function getStatusClass(status) {
            const map = {
                'Ø¬Ø¯ÙŠØ¯': 'new',
                'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©': 'review',
                'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©': 'processing',
                'Ø¬Ø§Ù‡Ø²': 'ready',
                'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†': 'shipping',
                'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…': 'delivered',
                'Ù…Ù„ØºÙŠ': 'cancelled'
            };
            return map[status] || 'new';
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙ„Ø§ØªØ±
        function setupFilters() {
            document.getElementById('filterCountry').addEventListener('change', applyFilters);
            document.getElementById('filterStatus').addEventListener('change', applyFilters);
            document.getElementById('filterPayment').addEventListener('change', applyFilters);
            document.getElementById('filterPaymentStatus').addEventListener('change', applyFilters);
            document.getElementById('filterDiscount').addEventListener('change', applyFilters);
            document.getElementById('searchOrders').addEventListener('input', applyFilters);
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
        function applyFilters() {
            const country = document.getElementById('filterCountry').value;
            const status = document.getElementById('filterStatus').value;
            const payment = document.getElementById('filterPayment').value;
            const paymentStatus = document.getElementById('filterPaymentStatus').value;
            const discount = document.getElementById('filterDiscount').value;
            const search = document.getElementById('searchOrders').value.toLowerCase();
            
            let filtered = allOrders;
            
            if (country) {
                filtered = filtered.filter(order => {
                    const orderCountry = order.customer?.address?.country || order.customer?.country;
                    return orderCountry === country;
                });
            }
            
            if (status) {
                filtered = filtered.filter(order => order.status === status);
            }
            
            if (payment) {
                filtered = filtered.filter(order => order.payment?.method === payment);
            }
            
            if (paymentStatus) {
                filtered = filtered.filter(order => order.paymentStatus === paymentStatus);
            }
            
            if (discount === 'with-discount') {
                filtered = filtered.filter(order => 
                    order.discount?.applied || order.discountInfo?.applied
                );
            } else if (discount === 'without-discount') {
                filtered = filtered.filter(order => 
                    !order.discount?.applied && !order.discountInfo?.applied
                );
            }
            
            if (search) {
                filtered = filtered.filter(order => {
                    return (
                        (order.orderId && order.orderId.toString().includes(search)) ||
                        (order.customer?.name && order.customer.name.toLowerCase().includes(search)) ||
                        (order.customer?.fullName && order.customer.fullName.toLowerCase().includes(search)) ||
                        (order.customer?.phone && order.customer.phone.includes(search)) ||
                        (order.customer?.email && order.customer.email.toLowerCase().includes(search)) ||
                        (order.discount?.code && order.discount.code.toLowerCase().includes(search)) ||
                        (order.discountInfo?.code && order.discountInfo.code.toLowerCase().includes(search))
                    );
                });
            }
            
            displayOrders(filtered);
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹
        async function updatePaymentStatus(orderId, paymentStatus) {
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) return;
            
            order.paymentStatus = paymentStatus;
            order.paymentUpdatedAt = new Date().toISOString();
            
            if (order.source === 'firebase' && order.firebaseId) {
                try {
                    await db.collection('orders').doc(order.firebaseId).update({
                        paymentStatus: paymentStatus,
                        paymentUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:', error);
                }
            }
            
            updatePaymentInLocalStorage(order);
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ø·Ù„Ø¨ #${order.orderId || order.id}`);
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙÙŠ localStorage
        function updatePaymentInLocalStorage(order) {
            try {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const orderIndex = orders.findIndex(o => o.orderNumber == order.orderId);
                if (orderIndex !== -1) {
                    orders[orderIndex].paymentStatus = order.paymentStatus;
                    localStorage.setItem('orders', JSON.stringify(orders));
                }
                
                const newOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                const newOrderIndex = newOrders.findIndex(o => o.orderId == order.orderId);
                if (newOrderIndex !== -1) {
                    newOrders[newOrderIndex].paymentStatus = order.paymentStatus;
                    localStorage.setItem('new_orders', JSON.stringify(newOrders));
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« localStorage:', error);
            }
        }

        // Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ - Ù…Ø­Ø³Ù‘Ù† ÙˆÙ„Ø§ ÙŠØ¹ÙˆØ¯ Ù„Ù„Ø¸Ù‡ÙˆØ±
        async function deleteOrder(orderId, orderNumber) {
            if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ #${orderNumber}ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
                return;
            }
            
            try {
                // 1. Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                deletedOrders.add(orderNumber.toString());
                localStorage.setItem('deleted_orders', JSON.stringify(Array.from(deletedOrders)));
                
                // 2. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡
                const order = allOrders.find(o => o.id === orderId || o.orderId === orderNumber);
                
                // 3. Ø§Ù„Ø­Ø°Ù Ù…Ù† Firebase Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (order && order.source === 'firebase' && order.firebaseId) {
                    try {
                        await db.collection('orders').doc(order.firebaseId).delete();
                        console.log(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ #${orderNumber} Ù…Ù† Firebase`);
                    } catch (firebaseError) {
                        console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Firebase:', firebaseError);
                    }
                }
                
                // 4. Ø§Ù„Ø­Ø°Ù Ù…Ù† localStorage Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„
                removeOrderFromLocalStorage(orderNumber);
                
                // 5. Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                allOrders = allOrders.filter(o => 
                    o.id !== orderId && 
                    o.orderId !== orderNumber && 
                    o.orderId !== orderNumber.toString()
                );
                
                // 6. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
                currentFilteredOrders = currentFilteredOrders.filter(o => 
                    o.id !== orderId && 
                    o.orderId !== orderNumber && 
                    o.orderId !== orderNumber.toString()
                );
                
                // 7. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø©
                updateAllStats(allOrders);
                displayOrders(currentFilteredOrders);
                
                // 8. Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹
                closeModal();
                closeStatusModal();
                
                // 9. Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
                showNotification('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ #${orderNumber} Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙ„Ù† ÙŠØ¹ÙˆØ¯ Ù„Ù„Ø¸Ù‡ÙˆØ±`);
                
                // 10. ØªØ­Ø¯ÙŠØ« localStorage Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„ØªØ£ÙƒØ¯
                localStorage.setItem('orders', JSON.stringify(allOrders.filter(o => o.source === 'local')));
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù', error.message, 'error');
            }
        }

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† localStorage Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„
        function removeOrderFromLocalStorage(orderNumber) {
            try {
                // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† orders
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const filteredOrders = orders.filter(o => o.orderNumber != orderNumber);
                localStorage.setItem('orders', JSON.stringify(filteredOrders));
                
                // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† new_orders
                const newOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                const filteredNewOrders = newOrders.filter(o => o.orderId != orderNumber);
                localStorage.setItem('new_orders', JSON.stringify(filteredNewOrders));
                
                // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¢Ø®Ø±
                localStorage.removeItem(`order_${orderNumber}`);
                
                console.log(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ #${orderNumber} Ù…Ù† localStorage`);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† localStorage:', error);
            }
        }

        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
        function viewOrderDetails(orderId) {
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'error');
                return;
            }
            
            const customer = order.customer || {};
            const address = customer.address || {};
            const payment = order.payment || {};
            const totals = order.totals || {};
            const items = order.items || [];
            const discount = order.discount || order.discountInfo || {};
            
            const country = address.country || customer.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const currency = totals.currency || (country === 'Ù…ØµØ±' ? 'Ø¬.Ù…' : 'Ø±.Ø³');
            const shippingCost = order.shippingCost || order.totals?.shipping || 0;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©
            const governorate = address.governorate || customer.governorate || address.city || customer.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const city = address.city || customer.city || address.region || customer.region || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const detailedAddress = address.details || customer.address || address.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙÙŠØ±
            const originalTotal = discount.originalTotal || totals.total || 0;
            const finalTotal = totals.total || order.total || 0;
            const discountAmount = discount.amount || (originalTotal - finalTotal);
            const discountPercentage = originalTotal > 0 ? Math.round((discountAmount / originalTotal) * 100) : 0;
            
            // Ø­Ø³Ø§Ø¨ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            let productRevenue = 0;
            items.forEach(item => {
                productRevenue += (item.price || 0) * (item.quantity || 1);
            });
            
            // ØªØ­Ø¶ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            let itemsHtml = '';
            items.forEach((item, index) => {
                const itemTotal = (item.price || 0) * (item.quantity || 1);
                itemsHtml += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <strong>${item.name || 'Ù…Ù†ØªØ¬'}</strong>
                            ${item.id ? `<br><small style="color: var(--gray-light);">ÙƒÙˆØ¯: ${item.id}</small>` : ''}
                        </td>
                        <td>${item.quantity || 1}</td>
                        <td>${item.price || 0} ${currency}</td>
                        <td><strong>${itemTotal} ${currency}</strong></td>
                    </tr>
                `;
            });
            
            // Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®ØµÙ…
            let discountSection = '';
            if (discount.applied) {
                discountSection = `
                    <div class="discount-details">
                        <h4><i class="fas fa-gift"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®ØµÙ…</h4>
                        <div class="discount-row">
                            <span>ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…:</span>
                            <span style="color: var(--success); font-weight: bold;">${discount.code || '--'}</span>
                        </div>
                        <div class="discount-row">
                            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…:</span>
                            <span style="color: var(--success);">${discountPercentage}%</span>
                        </div>
                        <div class="discount-row">
                            <span>Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                            <span style="color: var(--success);">
                                ${discount.freeShipping ? 'Ù…Ø¬Ø§Ù†ÙŠ âœ…' : 'Ù…Ø¯ÙÙˆØ¹'}
                            </span>
                        </div>
                        <div class="discount-row">
                            <span>Ù…Ø¨Ù„Øº Ø§Ù„ØªÙˆÙÙŠØ±:</span>
                            <span style="color: var(--success); font-weight: bold;">${formatCurrency(discountAmount)} ${currency}</span>
                        </div>
                    </div>
                `;
            }
            
            const modalContent = `
                <div class="info-section">
                    <h4 class="section-title"><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</strong>
                            <span class="order-number">#${order.orderId || order.id}</span>
                        </div>
                        <div class="info-item">
                            <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</strong>
                            <span>${formatDate(order.createdAt)}</span>
                        </div>
                        <div class="info-item">
                            <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</strong>
                            <span class="status-badge status-${getStatusClass(order.status)}">
                                ${order.status || 'Ø¬Ø¯ÙŠØ¯'}
                            </span>
                        </div>
                        <div class="info-item">
                            <strong>Ø§Ù„Ø¨Ù„Ø¯</strong>
                            <span class="country-badge ${country === 'Ù…ØµØ±' ? 'egypt-badge' : 'saudi-badge'}">
                                ${country}
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h4 class="section-title"><i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</strong>
                            <span>${customer.name || customer.fullName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        <div class="info-item">
                            <strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</strong>
                            <span>${customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        <div class="info-item">
                            <strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</strong>
                            <span>${customer.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        <div class="info-item">
                            <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</strong>
                            <span class="${order.paymentStatus === 'paid' ? 'status-delivered' : 'status-review'}" style="padding: 5px 10px; border-radius: 4px;">
                                ${order.paymentStatus === 'paid' ? 'ØªÙ… Ø§Ù„Ø¯ÙØ¹' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹'}
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h4 class="section-title"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</strong>
                            <span>${governorate}</span>
                        </div>
                        <div class="info-item">
                            <strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</strong>
                            <span>${city}</span>
                        </div>
                        <div class="info-item">
                            <strong>Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†</strong>
                            <span style="color: ${discount.freeShipping ? 'var(--success)' : 'var(--accent)'}; font-weight: bold;">
                                ${discount.freeShipping ? 'Ù…Ø¬Ø§Ù†ÙŠ âœ…' : shippingCost + ' ' + currency}
                            </span>
                        </div>
                    </div>
                    <div class="info-item" style="margin-top: 20px;">
                        <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</strong>
                        <div class="address-box">${detailedAddress}</div>
                    </div>
                </div>
                
                ${discountSection}
                
                <div class="info-section">
                    <h4 class="section-title"><i class="fas fa-shopping-bag"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (${items.length})</h4>
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml || '<tr><td colspan="5" style="text-align: center; padding: 30px; color: var(--gray-light);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>'}
                        </tbody>
                    </table>
                </div>
                
                <div class="info-section">
                    <h4 class="section-title"><i class="fas fa-calculator"></i> Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ</h4>
                    <div class="financial-summary">
                        <div class="financial-item">
                            <span class="label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                            <span class="value">${formatCurrency(productRevenue)} ${currency}</span>
                        </div>
                        <div class="financial-item">
                            <span class="label">Ø§Ù„Ø´Ø­Ù†</span>
                            <span class="value">${discount.freeShipping ? 'Ù…Ø¬Ø§Ù†ÙŠ' : formatCurrency(shippingCost) + ' ' + currency}</span>
                        </div>
                        ${discount.applied ? `
                        <div class="financial-item original">
                            <span class="label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ</span>
                            <span class="value">${formatCurrency(originalTotal)} ${currency}</span>
                        </div>
                        <div class="financial-item discount">
                            <span class="label">Ø§Ù„Ø®ØµÙ…</span>
                            <span class="value">-${formatCurrency(discountAmount)} ${currency}</span>
                        </div>
                        ` : ''}
                        <div class="financial-item" style="grid-column: span 2; background: rgba(67, 97, 238, 0.1);">
                            <span class="label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
                            <span class="value" style="color: var(--accent); font-size: 1.5rem;">
                                ${formatCurrency(finalTotal)} ${currency}
                            </span>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button class="btn btn-edit" onclick="editOrderStatusModal('${order.id || order.orderId}')" style="flex: 1;">
                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
                    </button>
                    <button class="btn btn-danger" onclick="deleteOrder('${order.id || order.orderId}', '${order.orderId || order.id}')" style="flex: 1;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨
                    </button>
                </div>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('orderModal').classList.add('show');
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        function editOrderStatusModal(orderId) {
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'error');
                return;
            }
            
            const customer = order.customer || {};
            const customerName = customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±';
            const orderNumber = order.orderId || order.id;
            
            const modalContent = `
                <div style="padding: 20px;">
                    <div class="info-item" style="margin-bottom: 25px;">
                        <strong style="display: block; margin-bottom: 10px; color: var(--accent);">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong>
                        <span class="order-number">#${orderNumber}</span>
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 25px;">
                        <strong style="display: block; margin-bottom: 10px; color: var(--accent);">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong>
                        <span style="font-size: 1.1rem;">${customerName}</span>
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 30px;">
                        <strong style="display: block; margin-bottom: 15px; color: var(--accent);">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong>
                        <span class="status-badge status-${getStatusClass(order.status)}" style="font-size: 1rem;">
                            ${order.status || 'Ø¬Ø¯ÙŠØ¯'}
                        </span>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="newStatus" style="display: block; margin-bottom: 10px; color: var(--light);">
                            <i class="fas fa-edit"></i> Ø­Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
                        </label>
                        <select id="newStatus" style="width: 100%; padding: 12px; border-radius: 8px; background: #1e293b; border: 1px solid rgba(255,255,255,0.2); color: white;">
                            <option value="Ø¬Ø¯ÙŠØ¯" ${order.status === 'Ø¬Ø¯ÙŠØ¯' ? 'selected' : ''}>Ø¬Ø¯ÙŠØ¯</option>
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                            <option value="Ø¬Ø§Ù‡Ø²" ${order.status === 'Ø¬Ø§Ù‡Ø²' ? 'selected' : ''}>Ø¬Ø§Ù‡Ø²</option>
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†" ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</option>
                            <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" ${order.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…' ? 'selected' : ''}>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                            <option value="Ù…Ù„ØºÙŠ" ${order.status === 'Ù…Ù„ØºÙŠ' ? 'selected' : ''}>Ù…Ù„ØºÙŠ</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 30px;">
                        <label for="orderNotes" style="display: block; margin-bottom: 10px; color: var(--light);">
                            <i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):
                        </label>
                        <textarea id="orderNotes" rows="4" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; resize: vertical;">${order.notes || ''}</textarea>
                    </div>
                    
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-secondary" onclick="closeStatusModal()" style="flex: 1;">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button class="btn btn-success" onclick="updateOrderStatus('${order.id || order.orderId}')" style="flex: 1;">
                            <i class="fas fa-check"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('statusModalContent').innerHTML = modalContent;
            document.getElementById('statusModal').classList.add('show');
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        async function updateOrderStatus(orderId) {
            const newStatus = document.getElementById('newStatus').value;
            const orderNotes = document.getElementById('orderNotes').value.trim();
            
            const order = allOrders.find(o => o.id === orderId || o.orderId === orderId);
            if (!order) {
                showNotification('Ø®Ø·Ø£', 'Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            order.status = newStatus;
            if (orderNotes) {
                order.notes = orderNotes;
            }
            order.statusUpdatedAt = new Date().toISOString();
            
            if (order.source === 'firebase' && order.firebaseId) {
                try {
                    await db.collection('orders').doc(order.firebaseId).update({
                        status: newStatus,
                        notes: orderNotes,
                        statusUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:', error);
                }
            }
            
            updateOrderInLocalStorage(order);
            closeStatusModal();
            updateAllStats(allOrders);
            displayOrders(currentFilteredOrders);
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ #${order.orderId || order.id} Ø¥Ù„Ù‰ "${newStatus}"`);
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ localStorage
        function updateOrderInLocalStorage(order) {
            try {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const orderIndex = orders.findIndex(o => o.orderNumber == order.orderId);
                if (orderIndex !== -1) {
                    orders[orderIndex].status = order.status;
                    if (order.notes) orders[orderIndex].notes = order.notes;
                    localStorage.setItem('orders', JSON.stringify(orders));
                }
                
                const newOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                const newOrderIndex = newOrders.findIndex(o => o.orderId == order.orderId);
                if (newOrderIndex !== -1) {
                    newOrders[newOrderIndex].status = order.status;
                    if (order.notes) newOrders[newOrderIndex].notes = order.notes;
                    localStorage.setItem('new_orders', JSON.stringify(newOrders));
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« localStorage:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${timeString}`;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        function refreshOrders() {
            loadOrders();
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        function exportToExcel() {
            if (allOrders.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§', 'error');
                return;
            }
            
            const data = allOrders.map((order, index) => {
                const customer = order.customer || {};
                const address = customer.address || {};
                const totals = order.totals || {};
                const items = order.items || [];
                const discount = order.discount || order.discountInfo || {};
                const country = address.country || customer.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const currency = totals.currency || (country === 'Ù…ØµØ±' ? 'EGP' : 'SAR');
                const shippingCost = order.shippingCost || order.totals?.shipping || 0;
                const governorate = address.governorate || customer.governorate || address.city || customer.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const city = address.city || customer.city || address.region || customer.region || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const discountAmount = discount.amount || 0;
                const originalTotal = discount.originalTotal || totals.total || 0;
                const finalTotal = totals.total || order.total || 0;
                
                // Ø­Ø³Ø§Ø¨ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                let productRevenue = 0;
                items.forEach(item => {
                    productRevenue += (item.price || 0) * (item.quantity || 1);
                });
                
                return {
                    'Ù…': index + 1,
                    'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨': order.orderId || order.id,
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®': formatDate(order.createdAt),
                    'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„': customer.name || customer.fullName || 'Ø²Ø§Ø¦Ø±',
                    'Ø§Ù„Ù‡Ø§ØªÙ': customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': customer.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    'Ø§Ù„Ø¨Ù„Ø¯': country,
                    'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©': governorate,
                    'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©': city,
                    'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ': address.details || customer.address || address.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹': getPaymentMethodArabic(order.payment?.method),
                    'Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹': order.paymentStatus === 'paid' ? 'ØªÙ… Ø§Ù„Ø¯ÙØ¹' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹',
                    'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª': productRevenue,
                    'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø­Ù†': discount.freeShipping ? 0 : shippingCost,
                    'Ø¹Ù…Ù„Ø© Ø§Ù„Ø´Ø­Ù†': currency,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…': discount.code || '--',
                    'Ù…Ø¨Ù„Øº Ø§Ù„Ø®ØµÙ…': discountAmount,
                    'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ': originalTotal,
                    'Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…': finalTotal,
                    'Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆÙÙŠØ±': originalTotal > 0 ? `${Math.round(((originalTotal - finalTotal) / originalTotal) * 100)}%` : '0%',
                    'Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨': order.status || 'Ø¬Ø¯ÙŠØ¯',
                    'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª': items.map(item => `${item.name} (Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity || 1})`).join('ØŒ '),
                    'Ù…Ù„Ø§Ø­Ø¸Ø§Øª': order.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯',
                    'Ø§Ù„Ù…ØµØ¯Ø±': order.source === 'firebase' ? 'Firebase' : 'Local'
                };
            });
            
            const headers = Object.keys(data[0]);
            const csvRows = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => {
                        const cell = row[header] || '';
                        if (typeof cell === 'string' && (cell.includes(',') || cell.includes('"') || cell.includes('\n'))) {
                            return `"${cell.replace(/"/g, '""')}"`;
                        }
                        return cell;
                    }).join(',')
                )
            ];
            
            const csvContent = '\uFEFF' + csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            const timeStr = `${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', `Ø·Ù„Ø¨Ø§Øª_Ù…Ø®ØªÙ„Ù_${dateStr}_${timeStr}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', `ØªÙ… ØªØµØ¯ÙŠØ± ${allOrders.length} Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            notification.className = 'notification';
            if (type === 'error') {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        function closeModal() {
            document.getElementById('orderModal').classList.remove('show');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø©
        function closeStatusModal() {
            document.getElementById('statusModal').classList.remove('show');
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuth()) {
                startAutoRefresh();
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
            }
            
            setInterval(updateLastUpdateTime, 60000);
        });
    </script>
</body>
</html>
